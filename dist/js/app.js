"use strict";var mapBoxApiKey="pk.eyJ1Ijoic3VwZXJ4aW4iLCJhIjoiY2thNWlqZHd4MDBpODNnb3owMDA2Y3dnYiJ9.-zciQf0emsOdjhIjB2uoNA",wpgTransitApiKey="G0ZNynR9C1I5fFkrMET",originForm=document.querySelector(".origin-form"),destinationForm=document.querySelector(".destination-form"),originResultsList=document.querySelector(".origins"),destinationResultsList=document.querySelector(".destinations"),tripPlanEle=document.querySelector(".my-trip"),resultsList=document.querySelectorAll("ul:not(.my-trip)"),btn=document.querySelector(".plan-trip");function searchLocations(e,t){fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e,".json?access_token=").concat(mapBoxApiKey,"&limit=10&bbox=-97.325875,49.766204,-96.953987,49.99275")).then(function(e){if(e.ok)return e.json();throw new Error("Fail to get data from API.")}).then(function(e){return updateResults(e.features,t)})}function updateResults(e,t){if(0===e.length)t.innerHTML='<div class="no-result">No results were found.</div>';else{var n="";e.forEach(function(e){void 0!==e.properties.address&&""!==e.properties.address||(e.properties.address="Winnipeg"),n+='   \n      <li data-long="'.concat(e.center[0],'" data-lat="').concat(e.center[1],'" class="">\n        <div class="name">').concat(e.text,"</div>\n        <div>").concat(e.properties.address,"</div>\n      </li> \n    ")}),t.innerHTML=n}}function clickResult(e){null!==e.target.closest("li")&&(document.querySelectorAll(".".concat(e.target.closest("ul").className," > li")).forEach(function(e){return e.classList.remove("selected")}),e.target.closest("li").classList.add("selected"))}function updateTripPlan(n){var o="";n.forEach(function(e,t){"walk"===e.type?(o+='\n        <li>\n          <i class="fas fa-walking" aria-hidden="true"></i>Walk for '.concat(e.times.durations.total," minutes to\n        "),0===t&&1!==n.length?o+="\n          stop #".concat(e.to.stop.key," - ").concat(e.to.stop.name,"            </li>\n        "):t!==n.length-1&&1!==n.length||(o+="\n          your destination\n          </li>\n        ")):"ride"===e.type?(void 0===e.route.name&&(e.route.name=e.route.key),o+='\n        <li>\n          <i class="fas fa-bus" aria-hidden="true"></i>Ride the '.concat(e.route.name," for ").concat(e.times.durations.total," minutes\n        </li>\n      ")):"transfer"===e.type&&(o+='\n        <li>\n          <i class="fas fa-ticket-alt" aria-hidden="true"></i>Transfer from stop #'.concat(e.from.stop.key," - ").concat(e.from.stop.name," to stop #").concat(e.to.stop.key," - ").concat(e.to.stop.name,"\n        </li>\n      "))}),tripPlanEle.innerHTML=o}originForm.addEventListener("submit",function(e){var t=originForm.querySelector("input");""!==t.value.trim()&&searchLocations(t.value,originResultsList),t.value="",e.preventDefault()}),destinationForm.addEventListener("submit",function(e){var t=destinationForm.querySelector("input");""!==t.value.trim()&&searchLocations(t.value,destinationResultsList),t.value="",e.preventDefault()}),originResultsList.addEventListener("click",function(e){return clickResult(e)}),destinationResultsList.addEventListener("click",function(e){return clickResult(e)}),btn.addEventListener("click",function(){var e=document.getElementsByClassName("selected");if(2===e.length){var t=[e[0].dataset.lat,e[0].dataset.long],n=[e[1].dataset.lat,e[1].dataset.long];document.querySelectorAll(".select-alert").forEach(function(e){return e.remove()}),t[0]===n[0]&&t[1]===n[1]?alert("Dude, where do you want to go?"):fetch("https://api.winnipegtransit.com/v3/trip-planner.json?origin=geo/".concat(t[0],",").concat(t[1],"&destination=geo/").concat(n[0],",").concat(n[1],"&api-key=").concat(wpgTransitApiKey)).then(function(e){if(e.ok)return e.json();throw new Error("Fail to get data from API.")}).then(function(e){void 0===e.plans[0]?tripPlanEle.innerHTML="<li>No plans were found.</li>":updateTripPlan(e.plans[0].segments)})}else 0===e.length?resultsList.forEach(function(e){return e.insertAdjacentHTML("beforebegin",'<div class="select-alert">Please select one result.</div>')}):resultsList.forEach(function(e){null===e.querySelector(".selected")&&e.insertAdjacentHTML("beforebegin",'<div class="select-alert">Please select one result.</div>')})});